kind: pipeline
name: ImageBreaker

platform:
  os: linux
  arch: amd64

clone:
  depth: 1

steps:
  - name: build
    environment:
      GITID:
        from_secret: GITID
      GITPWD:
        from_secret: GITPWD
      bot_token:
        from_secret: bot_token
      chat_id:
        from_secret: chat_id
    image: ubuntu:18.04
    commands:
      - export HOME=/drone
      - apt-get update && apt-get install -y git && git clone https://$GITID:$GITPWD@github.com/$(cat /drone/src/repo) -b $(cat /drone/src/branch) --depth=1 kernel
      - cd kernel
      - ./drone-setup
      - ./drone-build
